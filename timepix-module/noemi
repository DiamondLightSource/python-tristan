#%Module1.0

proc ModulesHelp { } {
  puts stderr "Loads tools for event-mode data collection on I19"
}
module-whatis "Loads tools for event-mode data collection on I19"

module load hdf5
module load i19
module load python/3

# Catch unidentified problem in the python/3 module that means conda doesn't get activated
# (probably a race condition in setting the PATH).
prepend-path PATH $env(PYTHON_BASE_HOME)/condabin
if {
    [module-info mode load]
    || [module-info mode switch2]
} {
    # instructions based on https://github.com/conda/conda/blob/master/CHANGELOG.md#440-2017-12-20
    puts stdout "source $env(PYTHON_BASE_HOME)/etc/profile.d/conda.sh;"
    puts stdout "conda activate python$env(pythonmajorversion);"
} elseif {
    [module-info mode remove]
    && ![module-info mode switch3]
} {
    puts stdout "conda deactivate;"
}
prepend-path PATH $env(PYTHON_BASE_HOME)/envs/python$env(pythonmajorversion)/bin

if {
    [module-info mode load]
    || [module-info mode switch2]
} {
    puts stderr "Loading data processing tools for Tristan-type events data."
} elseif {
    [module-info mode remove]
    && ![module-info mode switch3]
} {
    puts stderr "Unloading data processing tools for Tristan-type events data."
}

setenv TIMEPIX_I19 /scratch/python3/modules/timepix-i19
prepend-path PYTHONPATH $env(TIMEPIX_I19)

set-alias time_histogram {python3 \$TIMEPIX_I19/timepix/time_histogram.py}
set-alias make_images {python3 \$TIMEPIX_I19/timepix/timepix2M.py}
set-alias histogram time_histogram
